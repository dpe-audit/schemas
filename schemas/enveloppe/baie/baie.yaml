$id: https://schemas.dpe-audit.fr/enveloppe/baie
$schema: https://json-schema.org/draft/2020-12/schema
title: Baie
type: object
unevaluatedProperties: false
properties:
  id:
    title: Identifiant
    type: string
    format: uuid
  description:
    title: Description
    type: string
  type:
    title: Type
    type: string
    enum:
      - brique_verre_pleine
      - brique_verre_creuse
      - polycarbonate
      - fenetre_battante
      - fenetre_coulissante
      - porte_fenetre_coulissante
      - porte_fenetre_battante
  presence_protection_solaire:
    title: Présence de protection solaire
    type: boolean
  type_fermeture:
    title: Type de fermeture
    type: string
    enum:
      - sans_fermeture
      - jalousie_accordeon
      - fermeture_lames_orientables
      - venitiens_exterieurs_metal
      - volet_battant_avec_ajours_fixes
      - persiennes_avec_ajours_fixes
      - fermeture_sans_ajours
      - volets_roulants_aluminium
      - volets_roulants_pvc_bois_epaisseur_lte_12_mm
      - volets_roulants_pvc_bois_epaisseur_gt_12_mm
      - persienne_coulissante_epaisseur_lte_22_mm
      - persienne_coulissante_epaisseur_gt_22_mm
      - volet_battant_pvc_bois_epaisseur_lte_22_mm
      - volet_battant_pvc_bois_epaisseur_gt_22_mm
      - fermeture_isolee_sans_ajours
  annee_installation:
    title: Année d'installation
    type: ["integer", "null"]
    default: null
  ug:
    title: Coefficient de transmission thermique du vitrage connu et justifié en W/m²K
    type: ["number", "null"]
    exclusiveMinimum: 0
    default: null
  uw:
    title: Coefficient de transmission thermique de la baie connu et justifié en W/m²K
    type: ["number", "null"]
    exclusiveMinimum: 0
    default: null
  ujn:
    title: Coefficient de transmission thermique de la baie avec fermeture connu et justifié en W/m²K
    type: ["number", "null"]
    exclusiveMinimum: 0
    default: null
  sw:
    title: Proportion d'énergie solaire transmise par la baie en %
    type: ["number", "null"]
    minimum: 0
    maximum: 100
    default: null
  position:
    $ref: "#/$defs/position"
  menuiserie:
    $ref: "#/$defs/menuiserie"
  vitrage:
    $ref: "#/$defs/vitrage"
  survitrage:
    $ref: "#/$defs/survitrage"
  masques:
    title: Liste des masques
    type: array
    default: []
    items:
      type: string
      format: uuid
  data:
    $ref: "#/$defs/data"
required:
  - id
  - description
  - type
  - presence_protection_solaire
  - type_fermeture
  - position
  - vitrage
  - masques
oneOf:
  - title: Paroi vitrée
    type: object
    properties:
      type:
        enum: [brique_verre_pleine, brique_verre_creuse, polycarbonate]
      vitrage:
        type: object
        properties:
          type:
            enum: [brique_verre, polycarbonate]
      menuiserie:
        const: null
    required:
      - type
      - vitrage
  - title: Fenêtre
    type: object
    properties:
      type:
        enum: [fenetre_battante, fenetre_coulissante]
      position:
        type: object
        properties:
          type_pose:
            type: string
        required:
          - type_pose
      vitrage:
        type: object
        properties:
          type:
            not:
              enum: [brique_verre, polycarbonate]
      menuiserie:
        type: object
    required:
      - type
      - position
      - vitrage
      - menuiserie
  - title: Porte fenêtre
    type: object
    properties:
      type:
        enum: [porte_fenetre_coulissante, porte_fenetre_battante]
      position:
        type: object
        properties:
          type_pose:
            type: string
          presence_soubassement:
            type: boolean
        required:
          - type_pose
          - presence_soubassement
      vitrage:
        type: object
        properties:
          type:
            not:
              enum: [brique_verre, polycarbonate]
      menuiserie:
        type: object
    required:
      - type
      - position
      - vitrage
      - menuiserie
$defs:
  position:
    title: Position
    type: object
    properties:
      paroi_id:
        title: Identifiant de la paroi associée à la baie
        type: ["string", "null"]
        format: uuid
        default: null
      local_non_chauffe_id:
        title: Identifiant du local non chauffé associé à la baie
        type: ["string", "null"]
        format: uuid
        default: null
      double_fenetre_id:
        title: Identifiant de la double fenêtre associée
        type: ["string", "null"]
        format: uuid
        default: null
      surface:
        title: Surface déperditive exprimée en m²
        type: number
        minimum: 0
      mitoyennete:
        $ref: /enveloppe/paroi/mitoyennete
      type_pose:
        title: Type de pose
        type: ["string", "null"]
        enum: [nu_exterieur, nu_interieur, tunnel, null]
        default: null
      presence_soubassement:
        title: Présence d'un soubassement
        type: [boolean, "null"]
        default: null
      inclinaison:
        title: Inclinaison de la baie par rapport à l'horizontale en degré
        type: number
        minimum: 0
        maximum: 90
      orientation:
        title: Orientation de la baie en degré par rapport au nord
        type: [number, "null"]
        minimum: 0
        exclusiveMaximum: 360
    required:
      - paroi_id
      - surface
      - mitoyennete
      - inclinaison
      - orientation
    allOf:
      - oneOf:
          - title: Baie donnant sur un local non chauffé
            type: object
            properties:
              mitoyennete:
                const: local_non_chauffe
              local_non_chauffe_id:
                type: string
            required:
              - local_non_chauffe_id
              - mitoyennete
          - title: Autres cas
            type: object
            properties:
              mitoyennete:
                not:
                  const: local_non_chauffe
              local_non_chauffe_id:
                const: null
            required:
              - mitoyennete
      - oneOf:
          - title: Baie horizontale
            type: object
            properties:
              inclinaison:
                const: 0
              orientation:
                const: null
            required:
              - inclinaison
              - orientation
          - title: Autres cas
            type: object
            properties:
              inclinaison:
                minimumExlusive: 0
              orientation:
                type: number
            required:
              - inclinaison
              - orientation
  menuiserie:
    title: Menuiserie
    type: object
    properties:
      materiau:
        title: Matériau
        type: ["string", "null"]
        enum: [pvc, bois, bois_metal, metal, null]
        default: null
      largeur_dormant:
        title: Largeur dormant en mm
        type: ["number", "null"]
        exclusiveMinimum: 0
        default: null
      presence_joint:
        title: Présence de joint d'étanchéité
        type: ["boolean", "null"]
        default: null
      presence_retour_isolation:
        title: Présence d'un retour d'isolation
        type: ["boolean", "null"]
        default: null
      presence_rupteur_pont_thermique:
        title: Présence d'un rupteur de pont thermique
        type: ["boolean", "null"]
        default: null
    required:
      - materiau
      - largeur_dormant
      - presence_joint
      - presence_retour_isolation
      - presence_rupteur_pont_thermique
  vitrage:
    title: Vitrage
    type: object
    properties:
      type:
        title: Type
        type: string
        enum:
          - brique_verre
          - polycarbonate
          - simple_vitrage
          - double_vitrage
          - double_vitrage_fe
          - triple_vitrage
          - triple_vitrage_fe
      nature_lame:
        title: Nature de la lame d'air
        type: ["string", "null"]
        enum: [air, argon, krypton, null]
        default: null
      epaisseur_lame:
        title: Epaisseur de la lame d'air en mm
        type: ["number", "null"]
        exclusiveMinimum: 0
        default: null
    required:
      - type
    oneOf:
      - title: Paroi vitrée
        properties:
          type:
            enum: [brique_verre, polycarbonate]
          nature_lame:
            const: null
          epaisseur_lame:
            const: null
        required:
          - type
      - title: Vitrage simple
        properties:
          type:
            const: simple_vitrage
          nature_lame:
            const: null
          epaisseur_lame:
            const: null
        required:
          - type
      - title: Vitrage complexe
        properties:
          type:
            not:
              enum: [brique_verre, polycarbonate, simple_vitrage]
        required:
          - type
  survitrage:
    title: Survitrage
    type: object
    properties:
      type:
        title: Type de survitrage
        type: ["string", "null"]
        enum: [survitrage_simple, survitrage_fe, null]
        default: null
      epaisseur_lame:
        title: Epaisseur de la lame d'air en mm
        type: ["number", "null"]
        minimum: 0
        default: null
    required:
      - type
      - epaisseur_lame
  data:
    title: Données calculées
    type: object
    properties:
      ug:
        title: Coefficient de transmission thermique du vitrage en W/m²K
        type: ["number", "null"]
      uw:
        title: Coefficient de transmission thermique de la baie en W/m²K
        type: ["number", "null"]
      deltar:
        title: Résistance thermique additionnelle due aux fermetures exprimée en m².K/W
        type: ["number", "null"]
      fe:
        title: Facteur d'ensoleillement de la baie
        type: ["number", "null"]
      sw:
        title: Proportion d'énergie solaire transmise par la baie
        type: ["number", "null"]
      sse:
        title: Surface sud équivalente de la baie en m²
        type: ["number", "null"]
    allOf:
      - $ref: /enveloppe/paroi/data
