$id: https://schemas.dpe-audit.fr/ressource
$schema: https://json-schema.org/draft/2020-12/schema
title: Ressource
type: object
properties:
  id:
    title: Identifiant
    type: string
    format: uuid
    readOnly: true
  date_visite:
    title: Date de visite du logement
    type: string
    format: date
  date_etablissement:
    title: Date d'établissement
    type: string
    format: date
  adresse:
    $ref: "#/$defs/adresse"
  batiment:
    $ref: "#/$defs/batiment"
  logements:
    title: Liste des logements visités
    type: array
    default: []
    items:
      $ref: /logement
  enveloppe:
    $ref: /enveloppe
  chauffage:
    $ref: /chauffage
  ecs:
    $ref: /ecs
  ventilation:
    $ref: /ventilation
  refroidissement:
    $ref: /refroidissement
  production:
    $ref: /production
  data:
    $ref: "#/$defs/data"
required:
  - date_visite
  - date_etablissement
  - adresse
  - batiment
  - logements
  - chauffage
  - ecs
  - ventilation
  - refroidissement
  - production
$defs:
  adresse:
    title: Adresse
    type: object
    properties:
      ban_id:
        title: Identifiant depuis la Base Adresse Nationale (BAN)
        description: Clé d'interopérabilité telle que définie dans la spécification du format d'échange BAL
        type: [string, "null"]
        default: null
      nom:
        title: Numéro éventuel et nom de voie ou lieu dit
        type: string
      code_postal:
        title: Code postal de la commune
        type: string
      code_insee:
        title: Code INSEE de la commune
        type: string
      commune:
        title: Nom officiel de la commune
        type: string
    required:
      - ban_id
      - nom
      - code_postal
      - code_insee
      - commune
  batiment:
    title: Bâtiment
    type: object
    properties:
      rnb_id:
        title: Identifiant du bâtiment depuis le RNB
        type: ["string", "null"]
        default: null
      type:
        title: Type de bâtiment
        description: Donnée calculée à partir du nombre de logements
        type: string
        enum: [maison, immeuble]
      annee_construction:
        title: Année de construction
        type: integer
      altitude:
        title: Altitude du bâtiment en mètres
        type: number
      logements:
        title: Nombre de logements
        type: integer
        exclusiveMinimum: 0
      surface_habitable:
        title: Surface habitable en m²
        type: number
        exclusiveMinimum: 0
      hauteur_sous_plafond:
        title: Hauteur moyenne sous plafond en m
        type: number
        exclusiveMinimum: 0
      materiaux_anciens:
        title: Bâtiment majoritairement composé de matériaux anciens
        type: boolean
      data:
        $ref: "#/$defs/data"
    required:
      - rnb_id
      - type
      - annee_construction
      - altitude
      - logements
      - surface_habitable
      - hauteur_sous_plafond
      - materiaux_anciens
  data:
    title: Données calculées
    type: object
    readOnly: true
    properties:
      zone_thermique:
        title: Zone thermique
        type: object
        properties:
          zone_climatique:
            title: Zone climatique
            type: string
            enum: [H1a, H1b, H1c, H2a, H2b, H2c, H2d, H3]
          effet_joule:
            title: Bâtiment chauffé par effet joule
            type: boolean
          parois_anciennes_lourdes:
            title: Bâtiment constitué de parois anciennes lourdes
            type: boolean
          surface_reference:
            title: Surface thermique de référence en m²
            type: number
            minimumExclusive: 0
          volume_reference:
            title: Volume thermique de référence en m³
            type: number
            minimumExclusive: 0
      bilan:
        title: Bilan
        type: object
        properties:
          cef:
            title: Consommation d'énergie finale en kWh/m²/an
            type: number
            minimum: 0
          cep:
            title: Consommation d'énergie primaire en kWh/m²/an
            type: number
            minimum: 0
          eges:
            title: Émissions de gaz à effet de serre en kgCO2/m²/an
            type: number
            minimum: 0
          etiquette_energie:
            title: Etiquette énergie
            type: string
            enum: [A, B, C, D, E, F, G]
          etiquette_climat:
            title: Etiquette climat
            type: string
            enum: [A, B, C, D, E, F, G]
      consommations:
        title: Consommations d'énergie
        type: array
        items:
          type: object
          properties:
            energie:
              $ref: /common/energie
            usage:
              $ref: /common/usage
            cef:
              title: Consommation d'énergie finale en kWh/an
              type: number
            cep:
              title: Consommation d'énergie primaire en kWh/an
              type: number
      emissions:
        title: Emissions de gaz à effet de serre
        type: array
        items:
          type: object
          properties:
            energie:
              $ref: /common/energie
            usage:
              $ref: /common/usage
            eges:
              title: Émissions de gaz à effet de serre en kgCO2/an
              type: number
